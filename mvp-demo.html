<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Recording Studio - MVP Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .recording-indicator {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2 text-blue-400">ğŸ® Game Recording Studio</h1>
            <p class="text-gray-400">AI Training Data Capture Platform - MVP Demo</p>
        </div>

        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <span class="mr-2">ğŸ“º</span> Recording Controls
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Screen Source</label>
                    <select id="screenSelect" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                        <option value="screen">Entire Screen</option>
                        <option value="window">Application Window</option>
                    </select>
                </div>

                <div class="flex items-end">
                    <button id="recordBtn" class="w-full bg-green-600 hover:bg-green-700 px-6 py-2 rounded font-medium transition-colors">
                        â–¶ï¸ Start Recording
                    </button>
                </div>
            </div>

            <div id="recordingStatus" class="hidden flex items-center gap-2 mb-4">
                <span class="inline-block w-3 h-3 bg-red-500 rounded-full recording-indicator"></span>
                <span class="text-red-400 font-medium">ğŸ”´ RECORDING ACTIVE</span>
                <span id="sessionId" class="text-sm text-gray-400"></span>
            </div>
        </div>

        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <span class="mr-2">ğŸ‘ï¸</span> Live Preview
            </h2>
            <div class="relative bg-black rounded-lg overflow-hidden aspect-video">
                <video id="previewVideo" class="w-full h-full object-contain hidden"></video>
                <canvas id="overlayCanvas" class="absolute inset-0 w-full h-full hidden"></canvas>
                <div id="placeholder" class="absolute inset-0 flex items-center justify-center text-gray-500">
                    <div class="text-center">
                        <div class="text-6xl mb-4">ğŸ“º</div>
                        <p>Click "Start Recording" to begin</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-gray-800 rounded-lg p-4">
                <h3 class="font-semibold mb-2 flex items-center">
                    <span class="mr-2">ğŸ“º</span> Screen Capture
                </h3>
                <div id="screenStatus" class="inline-block px-2 py-1 rounded text-xs bg-gray-700">Inactive</div>
                <p class="text-xs text-gray-400 mt-1">Capturing display with system audio</p>
            </div>

            <div class="bg-gray-800 rounded-lg p-4">
                <h3 class="font-semibold mb-2 flex items-center">
                    <span class="mr-2">ğŸ“¹</span> Webcam
                </h3>
                <div id="webcamStatus" class="inline-block px-2 py-1 rounded text-xs bg-gray-700">Inactive</div>
                <p class="text-xs text-gray-400 mt-1">720p overlay recording</p>
            </div>

            <div class="bg-gray-800 rounded-lg p-4">
                <h3 class="font-semibold mb-2 flex items-center">
                    <span class="mr-2">âŒ¨ï¸</span> Input Events
                </h3>
                <div id="inputStatus" class="inline-block px-2 py-1 rounded text-xs bg-gray-700">Inactive</div>
                <p class="text-xs text-gray-400 mt-1">Keyboard & mouse data</p>
            </div>
        </div>

        <div id="sessionInfo" class="bg-gray-800 rounded-lg p-6 hidden">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š Session Info</h2>
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div><span class="font-medium">Session ID:</span> <span id="infoSessionId"></span></div>
                <div><span class="font-medium">Input Events:</span> <span id="inputCount">0</span></div>
                <div><span class="font-medium">Start Time:</span> <span id="startTime"></span></div>
                <div><span class="font-medium">Duration:</span> <span id="duration">0s</span></div>
            </div>
        </div>
    </div>

    <script>
        let isRecording = false;
        let recordingSession = null;
        let inputEvents = [];
        let startTime = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let screenStream = null;
        let webcamStream = null;
        let animationFrame = null;

        const recordBtn = document.getElementById('recordBtn');
        const recordingStatus = document.getElementById('recordingStatus');
        const sessionId = document.getElementById('sessionId');
        const previewVideo = document.getElementById('previewVideo');
        const overlayCanvas = document.getElementById('overlayCanvas');
        const placeholder = document.getElementById('placeholder');
        const sessionInfo = document.getElementById('sessionInfo');

        // Status elements
        const screenStatus = document.getElementById('screenStatus');
        const webcamStatus = document.getElementById('webcamStatus');
        const inputStatus = document.getElementById('inputStatus');
        const infoSessionId = document.getElementById('infoSessionId');
        const inputCount = document.getElementById('inputCount');
        const startTimeEl = document.getElementById('startTime');
        const durationEl = document.getElementById('duration');

        recordBtn.addEventListener('click', async () => {
            if (isRecording) {
                stopRecording();
            } else {
                await startRecording();
            }
        });

        async function startRecording() {
            try {
                // Get screen capture
                screenStream = await navigator.mediaDevices.getDisplayMedia({
                    video: { mediaSource: 'screen' },
                    audio: true
                });

                // Get webcam
                webcamStream = await navigator.mediaDevices.getUserMedia({
                    video: { width: 1280, height: 720 },
                    audio: false // No mic as requested
                });

                // Create combined stream
                const combinedStream = new MediaStream([
                    ...screenStream.getVideoTracks(),
                    ...webcamStream.getVideoTracks(),
                    ...screenStream.getAudioTracks()
                ]);

                // Setup video preview
                previewVideo.srcObject = combinedStream;
                previewVideo.play();

                // Setup canvas overlay
                const canvas = overlayCanvas;
                const ctx = canvas.getContext('2d');
                canvas.width = 1920;
                canvas.height = 1080;

                function drawOverlay() {
                    if (isRecording && ctx) {
                        ctx.drawImage(previewVideo, 0, 0, canvas.width, canvas.height);
                        // Draw webcam overlay (top-right corner)
                        ctx.drawImage(previewVideo, canvas.width - 320, 20, 300, 200);
                        animationFrame = requestAnimationFrame(drawOverlay);
                    }
                }

                // Create session
                const sessionIdValue = `recording_${Date.now()}`;
                recordingSession = {
                    id: sessionIdValue,
                    startTime: Date.now(),
                    inputEvents: []
                };

                startTime = Date.now();

                // Start MediaRecorder
                mediaRecorder = new MediaRecorder(combinedStream, {
                    mimeType: 'video/webm;codecs=vp9'
                });

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${recordingSession.id}.webm`;
                    a.click();

                    // Save input events
                    const inputData = {
                        sessionId: recordingSession.id,
                        startTime: recordingSession.startTime,
                        inputEvents: recordingSession.inputEvents,
                        duration: Date.now() - recordingSession.startTime
                    };

                    const inputBlob = new Blob([JSON.stringify(inputData, null, 2)], { type: 'application/json' });
                    const inputUrl = URL.createObjectURL(inputBlob);
                    const inputA = document.createElement('a');
                    inputA.href = inputUrl;
                    inputA.download = `${recordingSession.id}_input.json`;
                    inputA.click();
                };

                // Update UI
                isRecording = true;
                recordBtn.innerHTML = 'â¹ï¸ Stop Recording';
                recordBtn.className = recordBtn.className.replace('bg-green-600 hover:bg-green-700', 'bg-red-600 hover:bg-red-700');

                recordingStatus.classList.remove('hidden');
                sessionId.textContent = recordingSession.id;
                placeholder.classList.add('hidden');
                overlayCanvas.classList.remove('hidden');
                sessionInfo.classList.remove('hidden');

                screenStatus.textContent = 'Active';
                screenStatus.className = 'inline-block px-2 py-1 rounded text-xs bg-green-700';
                webcamStatus.textContent = 'Active';
                webcamStatus.className = 'inline-block px-2 py-1 rounded text-xs bg-green-700';
                inputStatus.textContent = 'Logging';
                inputStatus.className = 'inline-block px-2 py-1 rounded text-xs bg-blue-700';

                infoSessionId.textContent = recordingSession.id;
                startTimeEl.textContent = new Date(startTime).toLocaleTimeString();

                mediaRecorder.start(1000);
                drawOverlay();

            } catch (error) {
                console.error('Error starting recording:', error);
                alert('Failed to start recording. Please check permissions and try again.');
            }
        }

        function stopRecording() {
            if (mediaRecorder) {
                mediaRecorder.stop();
            }

            if (screenStream) {
                screenStream.getTracks().forEach(track => track.stop());
            }

            if (webcamStream) {
                webcamStream.getTracks().forEach(track => track.stop());
            }

            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
            }

            // Update UI
            isRecording = false;
            recordBtn.innerHTML = 'â–¶ï¸ Start Recording';
            recordBtn.className = recordBtn.className.replace('bg-red-600 hover:bg-red-700', 'bg-green-600 hover:bg-green-700');

            recordingStatus.classList.add('hidden');
            overlayCanvas.classList.add('hidden');
            placeholder.classList.remove('hidden');

            screenStatus.textContent = 'Inactive';
            screenStatus.className = 'inline-block px-2 py-1 rounded text-xs bg-gray-700';
            webcamStatus.textContent = 'Inactive';
            webcamStatus.className = 'inline-block px-2 py-1 rounded text-xs bg-gray-700';
            inputStatus.textContent = 'Inactive';
            inputStatus.className = 'inline-block px-2 py-1 rounded text-xs bg-gray-700';

            recordingSession = null;
            recordedChunks = [];
        }

        // Input event listeners
        function handleKeyDown(event) {
            if (!isRecording || !recordingSession) return;
            recordingSession.inputEvents.push({
                timestamp: Date.now(),
                type: 'keyboard',
                event: 'keydown',
                data: {
                    key: event.key,
                    code: event.code,
                    ctrlKey: event.ctrlKey,
                    altKey: event.altKey,
                    shiftKey: event.shiftKey
                }
            });
            updateInputCount();
        }

        function handleKeyUp(event) {
            if (!isRecording || !recordingSession) return;
            recordingSession.inputEvents.push({
                timestamp: Date.now(),
                type: 'keyboard',
                event: 'keyup',
                data: {
                    key: event.key,
                    code: event.code
                }
            });
            updateInputCount();
        }

        function handleMouseMove(event) {
            if (!isRecording || !recordingSession) return;
            recordingSession.inputEvents.push({
                timestamp: Date.now(),
                type: 'mouse',
                event: 'mousemove',
                data: {
                    x: event.clientX,
                    y: event.clientY,
                    screenX: event.screenX,
                    screenY: event.screenY
                }
            });
            updateInputCount();
        }

        function handleMouseDown(event) {
            if (!isRecording || !recordingSession) return;
            recordingSession.inputEvents.push({
                timestamp: Date.now(),
                type: 'mouse',
                event: 'mousedown',
                data: {
                    button: event.button,
                    x: event.clientX,
                    y: event.clientY
                }
            });
            updateInputCount();
        }

        function handleMouseUp(event) {
            if (!isRecording || !recordingSession) return;
            recordingSession.inputEvents.push({
                timestamp: Date.now(),
                type: 'mouse',
                event: 'mouseup',
                data: {
                    button: event.button,
                    x: event.clientX,
                    y: event.clientY
                }
            });
            updateInputCount();
        }

        function updateInputCount() {
            if (recordingSession) {
                inputCount.textContent = recordingSession.inputEvents.length;
            }
        }

        // Update duration
        setInterval(() => {
            if (isRecording && startTime) {
                const duration = Math.round((Date.now() - startTime) / 1000);
                durationEl.textContent = `${duration}s`;
            }
        }, 1000);

        // Add event listeners
        document.addEventListener('keydown', handleKeyDown);
        document.addEventListener('keyup', handleKeyUp);
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mousedown', handleMouseDown);
        document.addEventListener('mouseup', handleMouseUp);

        // Instructions
        console.log('ğŸ® Game Recording Studio MVP Demo');
        console.log('ğŸ“‹ Features:');
        console.log('- Screen recording with system audio');
        console.log('- Webcam overlay');
        console.log('- Keyboard and mouse event logging');
        console.log('- Automatic file download on stop');
        console.log('ğŸ”§ Data format ready for AI training');
    </script>
</body>
</html>
